<?php require_once __DIR__.'/../includes/db_connect.php'; if($_SERVER['REQUEST_METHOD']!=='POST'){ echo 'Method not allowed'; exit;} $email=$_POST['email']??''; $pass=$_POST['password']??''; if($pdo){ $stmt=$pdo->prepare('SELECT id,password FROM users WHERE email=? LIMIT 1'); $stmt->execute([$email]); $user=$stmt->fetch(PDO::FETCH_ASSOC); if($user && password_verify($pass,$user['password'])){ session_start(); $_SESSION['user_id']=$user['id']; echo 'OK'; exit; } } else { $f=__DIR__.'/../data_users.json'; if(file_exists($f)){ $users=json_decode(file_get_contents($f),true); foreach($users as $u){ if($u['email']==$email && password_verify($pass,$u['password'])){ session_start(); $_SESSION['user_email']=$email; echo 'OK (json)'; exit; } } } } echo 'Invalid credentials'; ?>